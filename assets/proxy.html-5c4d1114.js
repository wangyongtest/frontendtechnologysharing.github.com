import{$ as i,a0 as u,a1 as d,a4 as k,a2 as n,a3 as e,a5 as s,a7 as t,a6 as b,C as c}from"./framework-43d5a06a.js";const h="/frontendtechnologysharing.github.com/assets/javascript/proxy_definePrototy.png",m={},v=b(`<h2 id="proxy" tabindex="-1"><a class="header-anchor" href="#proxy" aria-hidden="true">#</a> Proxy</h2><p>Proxy 对象用于创建一个对象的代理，从而实现基本操作的拦截和自定义（如属性查找、赋值、枚举、函数调用等）</p><h3 id="语法" tabindex="-1"><a class="header-anchor" href="#语法" aria-hidden="true">#</a> 语法</h3><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>const p = new Proxy(target, handler)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="参数" tabindex="-1"><a class="header-anchor" href="#参数" aria-hidden="true">#</a> 参数</h3><ul><li>target <ul><li>要使用 Proxy 包装的目标对象（可以是任何类型的对象，包括原生数组，函数，甚至另一个代理）</li></ul></li><li>handler <ul><li>一个通常以函数作为属性的对象，各属性中的函数分别定义了在执行各种操作时代理 p 的行为</li></ul></li></ul><h3 id="handler-对象的方法" tabindex="-1"><a class="header-anchor" href="#handler-对象的方法" aria-hidden="true">#</a> handler 对象的方法</h3><p>handler 对象是一个容纳一批特定属性的占位符对象。它包含有 Proxy 的各个捕获器（trap）。<br> 所有的捕捉器是可选的。如果没有定义某个捕捉器，那么就会保留源对象的默认行为</p>`,8),y=n("br",null,null,-1),_={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf",target:"_blank",rel:"noopener noreferrer"},g=n("br",null,null,-1),f={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf",target:"_blank",rel:"noopener noreferrer"},x=n("br",null,null,-1),O={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/isExtensible",target:"_blank",rel:"noopener noreferrer"},P=n("br",null,null,-1),j={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/preventExtensions",target:"_blank",rel:"noopener noreferrer"},w=n("br",null,null,-1),z={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor",target:"_blank",rel:"noopener noreferrer"},C=n("br",null,null,-1),N={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty",target:"_blank",rel:"noopener noreferrer"},R=n("br",null,null,-1),S={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/in",target:"_blank",rel:"noopener noreferrer"},T=n("br",null,null,-1),W={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/get",target:"_blank",rel:"noopener noreferrer"},J=n("br",null,null,-1),E={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set",target:"_blank",rel:"noopener noreferrer"},G=n("br",null,null,-1),V={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/delete",target:"_blank",rel:"noopener noreferrer"},I=n("br",null,null,-1),A={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/getOwnPropertyNames",target:"_blank",rel:"noopener noreferrer"},H={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/getOwnPropertySymbols",target:"_blank",rel:"noopener noreferrer"},D=n("br",null,null,-1),L={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/apply",target:"_blank",rel:"noopener noreferrer"},M=n("br",null,null,-1),B={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new",target:"_blank",rel:"noopener noreferrer"},F=n("div",{class:"language-typescript line-numbers-mode","data-ext":"ts"},[n("pre",{class:"language-typescript"},[n("code",null,[e("  "),n("span",{class:"token keyword"},"function"),e(),n("span",{class:"token function"},"createReactiveObject"),n("span",{class:"token punctuation"},"("),e(`
  target`),n("span",{class:"token operator"},":"),e(" Target"),n("span",{class:"token punctuation"},","),e(`
  isReadonly`),n("span",{class:"token operator"},":"),e(),n("span",{class:"token builtin"},"boolean"),n("span",{class:"token punctuation"},","),e(`
  baseHandlers`),n("span",{class:"token operator"},":"),e(" ProxyHandler"),n("span",{class:"token operator"},"<"),n("span",{class:"token builtin"},"any"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},","),e(`
  collectionHandlers`),n("span",{class:"token operator"},":"),e(" ProxyHandler"),n("span",{class:"token operator"},"<"),n("span",{class:"token builtin"},"any"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},","),e(`
  proxyMap`),n("span",{class:"token operator"},":"),e(" WeakMap"),n("span",{class:"token operator"},"<"),e("Target"),n("span",{class:"token punctuation"},","),e(),n("span",{class:"token builtin"},"any"),n("span",{class:"token operator"},">"),e(`
`),n("span",{class:"token punctuation"},")"),e(),n("span",{class:"token punctuation"},"{"),e(`

  `),n("span",{class:"token comment"},"// target is already a Proxy, return it."),e(`
  `),n("span",{class:"token comment"},"// exception: calling readonly() on a reactive object"),e(`
  `),n("span",{class:"token keyword"},"if"),e(),n("span",{class:"token punctuation"},"("),e(`
    target`),n("span",{class:"token punctuation"},"["),e("ReactiveFlags"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"RAW"),n("span",{class:"token punctuation"},"]"),e(),n("span",{class:"token operator"},"&&"),e(`
    `),n("span",{class:"token operator"},"!"),n("span",{class:"token punctuation"},"("),e("isReadonly "),n("span",{class:"token operator"},"&&"),e(" target"),n("span",{class:"token punctuation"},"["),e("ReactiveFlags"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"IS_REACTIVE"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),e(`
  `),n("span",{class:"token punctuation"},")"),e(),n("span",{class:"token punctuation"},"{"),e(`
    `),n("span",{class:"token keyword"},"return"),e(` target
  `),n("span",{class:"token punctuation"},"}"),e(`

  `),n("span",{class:"token comment"},"// target already has corresponding Proxy"),e(`
  `),n("span",{class:"token keyword"},"const"),e(" existingProxy "),n("span",{class:"token operator"},"="),e(" proxyMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),e("target"),n("span",{class:"token punctuation"},")"),e(`
  `),n("span",{class:"token keyword"},"if"),e(),n("span",{class:"token punctuation"},"("),e("existingProxy"),n("span",{class:"token punctuation"},")"),e(),n("span",{class:"token punctuation"},"{"),e(`
    `),n("span",{class:"token keyword"},"return"),e(` existingProxy
  `),n("span",{class:"token punctuation"},"}"),e(`

  `),n("span",{class:"token comment"},"// only specific value types can be observed."),e(`
  `),n("span",{class:"token keyword"},"const"),e(" targetType "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token function"},"getTargetType"),n("span",{class:"token punctuation"},"("),e("target"),n("span",{class:"token punctuation"},")"),e(`
  `),n("span",{class:"token keyword"},"if"),e(),n("span",{class:"token punctuation"},"("),e("targetType "),n("span",{class:"token operator"},"==="),e(" TargetType"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"INVALID"),n("span",{class:"token punctuation"},")"),e(),n("span",{class:"token punctuation"},"{"),e(`
    `),n("span",{class:"token keyword"},"return"),e(` target
  `),n("span",{class:"token punctuation"},"}"),e(`

`),n("span",{class:"token comment"},"// 如果有自定有自定义的捕获器"),e(`
  `),n("span",{class:"token keyword"},"const"),e(" proxy "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token keyword"},"new"),e(),n("span",{class:"token class-name"},"Proxy"),n("span",{class:"token punctuation"},"("),e(`
    target`),n("span",{class:"token punctuation"},","),e(`
    targetType `),n("span",{class:"token operator"},"==="),e(" TargetType"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"COLLECTION"),e(),n("span",{class:"token operator"},"?"),e(" collectionHandlers "),n("span",{class:"token operator"},":"),e(` baseHandlers
  `),n("span",{class:"token punctuation"},")"),e(`

  proxyMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),e("target"),n("span",{class:"token punctuation"},","),e(" proxy"),n("span",{class:"token punctuation"},")"),e(`
  `),n("span",{class:"token keyword"},"return"),e(` proxy
`),n("span",{class:"token punctuation"},"}"),e(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),K=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"let"),e(" o "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),e(`
`),n("span",{class:"token comment"},"// 等同于："),e(`
Object`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"defineProperty"),n("span",{class:"token punctuation"},"("),e("o"),n("span",{class:"token punctuation"},","),e(),n("span",{class:"token string"},'"a"'),n("span",{class:"token punctuation"},","),e(),n("span",{class:"token punctuation"},"{"),e(`
  `),n("span",{class:"token literal-property property"},"value"),n("span",{class:"token operator"},":"),e(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),e(`
  `),n("span",{class:"token literal-property property"},"writable"),n("span",{class:"token operator"},":"),e(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),e(`
  `),n("span",{class:"token literal-property property"},"configurable"),n("span",{class:"token operator"},":"),e(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),e(`
  `),n("span",{class:"token literal-property property"},"enumerable"),n("span",{class:"token operator"},":"),e(),n("span",{class:"token boolean"},"true"),e(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e(`

`),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token template-punctuation string"},"`")]),e(`\`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),$=n("div",{class:"language-javascript line-numbers-mode","data-ext":"js"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"let"),e(" target "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),e(`
`),n("span",{class:"token keyword"},"let"),e(" p "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token keyword"},"new"),e(),n("span",{class:"token class-name"},"Proxy"),n("span",{class:"token punctuation"},"("),e("target"),n("span",{class:"token punctuation"},","),e(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e(`
p`),n("span",{class:"token punctuation"},"."),e("a "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token number"},"37"),n("span",{class:"token punctuation"},";"),e("   "),n("span",{class:"token comment"},"// 操作转发到目标"),e(`
console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),e("target"),n("span",{class:"token punctuation"},"."),e("a"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e("    "),n("span",{class:"token comment"},"// 37. 操作已经被正确地转发"),e(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),q=n("p",null,[n("img",{src:h,alt:"proxyOrDefinePrototy",loading:"lazy"}),n("strong",null,"参数区别:"),e(),n("code",null," 因此Vue2中对初始化的单个属性设置响应式，而Vue3中使用 proxy 是对整个对象做响应式")],-1);function Q(U,X){const a=c("ExternalLinkIcon"),p=c("CodeTabs");return u(),d("div",null,[k(" more "),v,n("ul",null,[n("li",null,[e("handler.getPrototypeOf() "),y,n("a",_,[e("Object.getPrototypeOf()"),s(a)]),e(" 方法的捕捉器")]),n("li",null,[e("handler.setPrototypeOf() "),g,n("a",f,[e("Object.setPrototypeOf()"),s(a)]),e(" 方法的捕捉器")]),n("li",null,[e("handler.isExtensible() "),x,n("a",O,[e("Object.isExtensible()"),s(a)]),e(" 方法的捕捉器")]),n("li",null,[e("handler.preventExtensions() "),P,n("a",j,[e("Object.preventExtensions()"),s(a)]),e(" 方法的捕捉器")]),n("li",null,[e("handler.getOwnPropertyDescriptor() "),w,n("a",z,[e("Object.getOwnPropertyDescriptor()"),s(a)]),e(" 方法的捕捉器")]),n("li",null,[e("handler.defineProperty() "),C,n("a",N,[e("Object.defineProperty()"),s(a)]),e(" 方法的捕捉器")]),n("li",null,[e("handler.has() "),R,n("a",S,[e("in"),s(a)]),e(" 操作符的捕捉器")]),n("li",null,[e("handler.get() "),T,n("a",W,[e("Object.get()"),s(a)]),e(" 属性读取操作的捕捉器")]),n("li",null,[e("handler.set() "),J,n("a",E,[e("Object.set()"),s(a)]),e(" 属性设置操作的捕捉器")]),n("li",null,[e("handler.deleteProperty() "),G,n("a",V,[e("delete"),s(a)]),e(" 操作符的捕捉器")]),n("li",null,[e("handler.ownKeys() "),I,n("a",A,[e("Object.getOwnPropertyNames"),s(a)]),e(" 方法和 "),n("a",H,[e("Object.getOwnPropertySymbols"),s(a)]),e(" 方法的捕捉器")]),n("li",null,[e("handler.apply()"),D,n("a",L,[e("Object.apply()"),s(a)]),e(" 函数调用操作的捕捉器")]),n("li",null,[e("handler.construct()"),M,n("a",B,[e("new"),s(a)]),e(" 操作符的捕捉器")])]),s(p,{id:"113",data:[{title:"vue3 源码"},{title:"Object.defineProperty"},{title:"Object.proxy"}],"tab-id":"shell"},{tab0:t(({title:o,value:l,isActive:r})=>[F]),tab1:t(({title:o,value:l,isActive:r})=>[K]),tab2:t(({title:o,value:l,isActive:r})=>[$]),_:1},8,["data"]),q])}const Z=i(m,[["render",Q],["__file","proxy.html.vue"]]);export{Z as default};
